// Function to fetch and display NEO data
async function fetchNeoData() {
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;
    
    // Construct URL with the user-provided dates
    const url = `${BASE_URL}?start_date=${startDate}&end_date=${endDate}&api_key=${API_KEY}`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        // Log the full response to inspect the structure
        console.log(data);

        if (data.error) {
            alert('Error: ' + data.error.message);
            return;
        }
        
        const neoList = data.near_earth_objects;
        displayNeos(neoList);
    } catch (error) {
        console.error('Error fetching data:', error);
        alert('Error fetching data from NASA API');
    }
}

// Function to display NEO data in a table
function displayNeos(neoList) {
    const neoTableBody = document.getElementById('neo-table-body');
    neoTableBody.innerHTML = ''; // Clear any previous data

    // Loop through each date and its NEOs
    for (const date in neoList) {
        const neos = neoList[date];
        for (const neo of neos) {
            const row = document.createElement('tr');
            
            // Check if SPK-ID exists in the NEO
            const spkId = neo.spk_id ? neo.spk_id : 'N/A';
            const name = neo.name || 'N/A';

            // Access the close_approach_data safely
            const approachData = neo.close_approach_data && neo.close_approach_data.length > 0 
                ? neo.close_approach_data[0]
                : null;
            
            const approachDate = approachData ? approachData.approach_date : 'N/A';
            const missDistance = approachData ? approachData.miss_distance.astronomical : 'N/A';

            // Append row to the table
            row.innerHTML = `
                <td>${name}</td>
                <td>${spkId}</td>
                <td>${approachDate}</td>
                <td>${missDistance} AU</td>
            `;
            neoTableBody.appendChild(row);
        }
    }
}

